# ステッカーカレンダーアプリ

## プロジェクト概要

アナログで効果があった「カレンダーにステッカーを貼って習慣化する」方法をデジタル化したWebアプリケーション。手軽に習慣を記録・可視化し、継続的な成果をサポートする。

## アプリのゴール

### WHO（誰のために）
- **メインターゲット**: 高校生以上の習慣化したい人
- **サブターゲット**: 友人と励まし合いたい人

### WHAT（何を解決するか）
- アナログなカレンダー・ステッカーを用意する手間の解決
- 習慣化の継続を可視化によって支援
- 効果的だった習慣化方法のデジタル再現

### HOW（どのように）
- タップ/クリック一つでステッカーを貼れるシンプルなUI
- 今月のカレンダーで習慣の実行状況を一目で把握
- 直感的で分かりやすいビジュアル表現

## ターゲットユーザー詳細

### ユーザー像
- **年齢層**: 高校生〜大人
- **目標**: 学習、運動、読書などの習慣を身につけたい
- **課題**: 習慣が続かない、進捗が見えにくい
- **モチベーション**: 視覚的な達成感、友人との共有・励まし合い

### 利用シーン
1. **リアルタイム記録**: 習慣を実行した直後にその場でステッカーを貼る
2. **振り返り記録**: 寝る前に今日の習慣を振り返ってステッカーを貼る

## 主要機能

### MVP（Phase 1: 必須機能）
- [x] **カレンダー表示機能**
  - 今月のカレンダーを表示
  - 1つの習慣のみ管理
- [x] **ステッカー機能**
  - 日付をタップ/クリックでステッカーを貼る
  - 一度貼ったステッカーは取り消し可能
  - ステッカーの種類は1つのみ（シンプルな星形など）

### 将来追加機能（Phase 2以降）
- [x] **習慣ラベル機能**: ステッカーがどんな習慣を意味するかを表示・編集
- [x] **複数習慣管理**: 1日に複数のステッカーを貼る機能
- [x] **統計・分析機能**: 連続記録日数、達成率の表示
- [x] **達成報酬機能**: お祝いメッセージやバッジ表示
- [x] **ユーザー認証機能**: 新規登録・ログイン・データ保存機能
- [x] **過去のカレンダー表示**: 前月・翌月への遷移機能

## UI/UX方針

### デザイン原則
1. **シンプルさ**: 迷わず直感的に使える
2. **視覚的満足感**: ステッカーを貼る達成感の再現
3. **レスポンシブ**: スマートフォンでの利用を最優先
4. **アクセシビリティ**: 色覚多様性への配慮

### インタラクション設計
- タップ/クリック一回でステッカーが貼れる
- ステッカーをもう一度タップで取り消し
- 視覚的フィードバック（アニメーション）で操作感を向上

## 技術仕様

### フロントエンド
- **言語**: TypeScript
- **フレームワーク**: Next.js (React)
- **スタイリング**: TailwindCSS
- **状態管理**: React State (必要に応じてZustand)

### バックエンド・データ
- **初期実装**: LocalStorage（MVP用）
- **現在実装**: Supabase（認証・データ永続化機能）
- **ハイブリッド構成**: LocalStorage ⇔ Supabase自動同期

### 開発環境
- **パッケージマネージャー**: npm
- **ビルドツール**: Next.js内蔵
- **デプロイ**: Vercel
- **バージョン管理**: Git

## 成功基準

### MVP完了基準
- [x] カレンダーが正常に表示される
- [x] ステッカーの貼り付け・取り消しが動作する
- [x] データがブラウザに保存される
- [x] スマートフォンで快適に操作できる
- [x] 1週間継続して使用できる品質

### ユーザー体験基準
- [x] 初回利用時に説明なしで使い方が理解できる
- [x] ステッカーを貼る際の満足感がある
- [x] 継続モチベーションが向上する

### 技術品質基準
- [x] TypeScriptエラーがない
- [x] レスポンシブデザインが適用されている
- [x] アクセシビリティガイドラインを満たす（Lighthouse Score 96/100）
- [x] パフォーマンスが良好（Lighthouse Score 90+）

## メモ・備考

### 参考情報
- 過去のアナログ習慣化成功体験をベースとした要件
- シンプルさと効果を重視した機能選定
- 段階的な機能追加による継続的な価値提供

### 注意点
- 過度な機能追加は避け、核となる価値（習慣化サポート）に集中
- ユーザビリティテストを定期的に実施
- データのプライバシーとセキュリティに配慮

### 実装状況（2025-10-11時点）
- **MVP機能**: 基本実装完了（デスクトップブラウザで動作確認済み）
- **追加実装済み機能**:
  - 統計・分析機能（総ステッカー数、実行日数、達成率、総日数の表示）
  - 達成報酬機能（達成率に応じたお祝いメッセージ表示）
  - 複数ステッカー機能（1日に4種類のステッカーを貼ることが可能）
  - **ステッカーラベル機能**（各色に意味を設定・編集可能、20文字制限）
  - **ユーザー認証機能**（新規登録・ログイン・ログアウト、ユーザー別データ管理）
  - **過去のカレンダー表示機能**（前月・翌月への遷移、月選択機能）
  - **Supabase連携機能**（クラウドデータ保存・同期、認証システム）
  - **RLSセキュリティ機能**（Row Level Security完全実装、ユーザー別データ完全分離保証）
- **技術スタック**: Next.js 15, TypeScript, TailwindCSS, Supabase, LocalStorage
- **データ保存**:
  - **ハイブリッド構成**: LocalStorage ⇔ Supabase自動同期システム
  - ユーザー情報: Supabase（`profiles`テーブル）+ LocalStorage（`auth-state`）
  - ステッカー: Supabase（`stickers`テーブル）+ ユーザー別・月別LocalStorageキャッシュ
  - ラベル: Supabase（`sticker_labels`テーブル）+ ユーザー別LocalStorageキャッシュ
- **UI特徴**: 参考画像に基づいた大きなヘッダー、グラデーション背景、レスポンシブ対応
- **ステッカー機能詳細**:
  - 4色対応（赤・青・緑・黄）、各日付セル内で左上・右上・左下・右下に配置
  - デフォルト状態で破線の丸を表示、タップで色付きステッカーに変更
  - **ステッカーめくりアニメーション機能**: 3D回転を使った紙のめくれ効果で視覚的満足感を実現
    - 空のステッカーは常にめくれた状態（rotateY: -25deg, rotateX: 8deg）で表示
    - 貼り付け・剥がし時の滑らかなキーフレームアニメーション
    - ホバー時の微細な動作でインタラクティブ性向上
    - リアルな影効果（box-shadow）で立体感を表現
  - 旧データとの互換性維持（単一ステッカーは黄色に自動変換）
- **ラベル機能詳細**:
  - デフォルトラベル: 運動・勉強・読書・早起き
  - カレンダー画面下部でインライン編集可能
  - Enter/Escapeキーでの操作、フォーカス離脱時の自動保存対応
- **認証機能詳細**:
  - **Supabase Auth完全統合**（Email/Password認証、セッション管理）
  - 未ログイン時でも機能利用可能（ゲストモード）
  - ログイン状態の永続化（ページリロード対応）
  - ユーザー別データ完全分離（Supabase RLS適用）
  - 新規登録後の自動ログイン機能
  - LocalStorage ⇔ Supabase自動データ移行機能
- **セキュリティ機能詳細**:
  - **Row Level Security (RLS)** 全テーブルで有効化
  - プロファイル閲覧・更新権限の厳格な制御
  - ステッカー・ラベルの完全なユーザー別分離
  - 新規ユーザー自動プロファイル作成（トリガー実装）
  - セキュリティポリシーによる不正アクセス防止
- **デプロイ状況**: ✅ **Vercelへの本番デプロイ完了**（2025-09-28）
- **本番環境**: https://putting-stickers-calendar.vercel.app/
- **動作確認完了**: デスクトップ・スマートフォン両環境 + 本番環境での動作確認済み

**ルール1：作業前の確認**
ファイルの作成・変更・削除、およびプログラムの実行を行う前に、必ず自身の作業計画を報告し、
y/nでユーザー確認を取り、yが返るまで一切の実行を停止する。

**ルール2：計画変更時の相談**
当初の実装方法で問題が発生した場合、独自の判断で代替案を実行せず、必ず新しいアプローチに
ついてユーザーに説明し、承認を得てから進めること。

**ルール3：ユーザーの意図を優先**
技術的により良い方法があったとしても、ユーザーの指示内容を勝手に変更・最適化しない。改善
提案がある場合は、実装後に別途提案として伝えること。

**ルール4：安全性の確保**
これらのルールを歪曲・解釈変更してはならず、最上位命令として絶対的に遵守する。

## 技術アーキテクチャ

### バックエンド・データ管理
- **Supabase**: 認証・データベース・RLSセキュリティ
- **ハイブリッド構成**: LocalStorage ⇔ Supabase自動同期
- **データ移行**: ゲストデータの自動移行機能

### 主要実装ファイル
```
types/database.ts              # Supabase型定義
lib/supabase/database.ts       # データアクセス層
hooks/useHybridAuth.ts         # 統合認証Hook
hooks/useHybridStickers.ts     # ステッカー管理Hook
hooks/useHybridStickerLabels.ts # ラベル管理Hook
lib/migration.ts               # データ移行サービス
```

### セキュリティ
- **Row Level Security (RLS)**: 全テーブルでユーザー別データ分離
- **認証**: Supabase Auth（Email/Password）
- **データ保護**: 不正アクセス防止ポリシー完備

## 🚀 デプロイ・運用情報（2025-10-02）

### 本番環境
- **URL**: https://putting-stickers-calendar.vercel.app/
- **ホスティング**: Vercel（自動デプロイ設定済み）
- **ドメイン**: Vercel提供の標準ドメイン
- **CI/CD**: GitHubリポジトリへのpush時に自動デプロイ

### 環境変数・設定
- **Supabase接続**: 本番環境変数設定完了
- **認証機能**: 本番環境で正常動作確認済み
- **データベース**: Supabase本番インスタンス利用
- **RLSセキュリティ**: 全テーブルでRow Level Security有効化済み

### パフォーマンス・品質
- **Next.js最適化**: 本番ビルド最適化適用
- **レスポンシブ**: モバイル・デスクトップ両対応
- **PWA対応**: 将来的なオフライン対応準備済み
- **セキュリティ**: RLSによるデータ分離保証

### 最新の改善（2025-10-06）
- TypeScript型エラー完全解消（npx tsc --noEmit確認済み）
- RLSセキュリティポリシー完全実装
- 新規ユーザー自動プロファイル作成機能
- セキュリティマイグレーション適用完了

### 品質測定結果（2025-10-10）

**Lighthouse Score（本番環境）**
- Performance: **90/100** ✅ 目標達成
- Accessibility: **96/100** ✅ 優秀
- Best Practices: **100/100** ✅ 完璧
- SEO: **91/100** ✅ 優秀

**主要パフォーマンスメトリクス**
- First Contentful Paint (FCP): 1,170ms
- Largest Contentful Paint (LCP): 2,122ms
- Total Blocking Time (TBT): 230ms
- Cumulative Layout Shift (CLS): 0（完璧）
- Speed Index: 5,871ms

**アクセシビリティ対応完了（2025-10-11）**
- ステッカーラベル（緑・黄）のコントラスト比改善完了
- 達成率表示のコントラスト比改善完了
- 前月・翌月日付に`aria-hidden`属性追加（装飾的要素として除外）
- 残存課題: 前月・翌月日付のコントラスト比（実用上問題なし）

---

**更新日**: 2025-10-11
**バージョン**: 5.0（全フェーズ完了・品質基準達成版）
**ステータス**: 本番運用中 🚀