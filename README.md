# ステッカーカレンダーアプリ

アナログで効果があった「カレンダーにステッカーを貼って習慣化する」方法をデジタル化したWebアプリケーション。手軽に習慣を記録・可視化し、継続的な成果をサポートします。

## 🎯 プロジェクト概要

### WHO（誰のために）
- **メインターゲット**: 高校生以上の習慣化したい人
- **サブターゲット**: 友人と励まし合いたい人

### WHAT（何を解決するか）
- アナログなカレンダー・ステッカーを用意する手間の解決
- 習慣化の継続を可視化によって支援
- 効果的だった習慣化方法のデジタル再現

### HOW（どのように）
- タップ/クリック一つでステッカーを貼れるシンプルなUI
- 今月のカレンダーで習慣の実行状況を一目で把握
- 直感的で分かりやすいビジュアル表現

## ✨ 主要機能

### 実装済み機能
- ✅ **カレンダー表示**: 月別カレンダーでの習慣管理
- ✅ **複数ステッカー機能**: 1日に4色のステッカーを貼ることが可能
- ✅ **ステッカーラベル機能**: 各色に意味を設定・編集可能（20文字制限）
- ✅ **ステッカーめくりアニメーション**: 3D回転効果で紙のステッカーのような視覚的満足感
- ✅ **統計・分析機能**: 総ステッカー数、実行日数、達成率、総日数の表示
- ✅ **達成報酬機能**: 達成率に応じたお祝いメッセージ表示
- ✅ **ユーザー認証機能**: 新規登録・ログイン・ユーザー別データ管理
- ✅ **過去のカレンダー表示**: 前月・翌月への遷移、月選択機能
- ✅ **Supabase連携**: クラウド同期・データ永続化・認証統合
- ✅ **データ移行機能**: LocalStorageからSupabaseへの自動移行完了
- ✅ **ハイブリッド構成**: オフライン対応 + クラウド同期
- ✅ **RLSセキュリティ**: Row Level Securityによるユーザー別データ完全分離

### 今後の実装予定
- 🚀 **月別ラベル管理機能**: 各月ごとに独立したステッカーラベルを設定・管理
- ⏳ **ステッカーカスタマイズ**: 複数の種類から選択可能

## 🛠 技術仕様

### フロントエンド
- **言語**: TypeScript（型安全性100%）
- **フレームワーク**: Next.js 15 (React)
- **スタイリング**: TailwindCSS
- **状態管理**: React Hooks（useState, useEffect）

### バックエンド・データ
- **認証・データベース**: Supabase
- **ハイブリッド構成**: LocalStorage ⇔ Supabase自動同期
- **オフライン対応**: LocalStorageでの完全動作
- **データ移行**: 既存LocalStorageからSupabaseへの自動移行
- **セキュリティ**: Row Level Security (RLS) 完全実装

### コード品質
- **型チェック**: TypeScriptエラー0件（`npx tsc --noEmit`）
- **ビルド**: 本番ビルド成功確認済み
- **エラーハンドリング**: 適切なエラーログ実装（本番環境対応）
- **コードスタイル**: ESLint準拠、不要コード削除済み

## 🌐 本番環境

**デプロイ済みアプリケーション**: https://putting-stickers-calendar.vercel.app/

すぐにお試しいただけます！新規登録またはゲストモードでご利用ください。

## 🚀 セットアップ

### 前提条件
- Node.js 18.0以上
- npm

### インストールと実行
```bash
# リポジトリのクローン
git clone https://github.com/your-username/putting-stickers-calendar.git
cd putting-stickers-calendar

# 依存関係のインストール
npm install

# 環境変数の設定
cp .env.local.example .env.local
# .env.localにSupabaseの設定を記入

# 開発サーバー起動
npm run dev
```

### Supabase設定（オプション）
クラウド同期機能を利用する場合：

1. [Supabase](https://supabase.com)でプロジェクトを作成
2. `.env.local`に以下を設定：
   ```
   NEXT_PUBLIC_SUPABASE_URL=your-project-url
   NEXT_PUBLIC_SUPABASE_ANON_KEY=your-anon-key
   ```
3. `supabase-setup.sql`を実行してテーブルを作成
4. `supabase/migrations/20250101000000_add_rls_security.sql`を実行してRLSを有効化

**注意**: Supabase設定なしでもLocalStorageモードで完全に動作します。

ブラウザで http://localhost:3000 を開いてアプリケーションにアクセスできます。

## 📱 使い方

1. **初回利用**: 新規登録またはゲストモードで開始
2. **ステッカー貼り**: 日付をタップして4色のステッカーから選択
3. **ラベル設定**: カレンダー下部でステッカーの意味を編集
4. **月表示切替**: ヘッダーの矢印で過去・未来の月を表示
5. **統計確認**: カレンダー下部で達成状況を確認

## 🏗 技術アーキテクチャ

### ディレクトリ構成
```
putting-stickers-calendar/
├── app/                    # Next.js App Router
│   ├── page.tsx           # メインページ（カレンダー表示）
│   ├── layout.tsx         # ルートレイアウト
│   └── auth/              # 認証関連ページ
├── components/            # UIコンポーネント
│   ├── Calendar.tsx       # カレンダーコンポーネント
│   ├── Stats.tsx          # 統計表示コンポーネント
│   ├── StickerLabels.tsx  # ラベル編集コンポーネント
│   └── Header.tsx         # ヘッダーコンポーネント
├── hooks/                 # カスタムフック
│   ├── useHybridAuth.ts          # 統合認証Hook
│   ├── useHybridStickers.ts      # ステッカー管理Hook
│   ├── useHybridStickerLabels.ts # ラベル管理Hook
│   ├── useSupabaseAuth.ts        # Supabase認証Hook
│   └── useAuth.ts                # LocalStorage認証Hook
├── lib/                   # ユーティリティ・サービス
│   ├── supabase/
│   │   ├── client.ts     # Supabaseクライアント
│   │   ├── database.ts   # データアクセス層
│   │   └── server.ts     # サーバーサイド処理
│   └── migration.ts       # データ移行サービス
└── types/                 # TypeScript型定義
    ├── database.ts        # Supabase型定義
    └── auth.ts            # 認証型定義
```

### データフロー
1. **認証フロー**: `useHybridAuth` → Supabase Auth / LocalStorage
2. **ステッカー操作**: `useHybridStickers` → Supabase DB / LocalStorage
3. **ラベル管理**: `useHybridStickerLabels` → Supabase DB / LocalStorage
4. **データ移行**: `migrationService` → LocalStorage → Supabase

### セキュリティ設計
- **Row Level Security (RLS)**: 全テーブルでユーザー別アクセス制御
- **認証トークン**: Supabase JWT認証
- **データ分離**: ユーザーIDによる完全なデータ分離保証

## 🎨 UI/UX特徴

- **シンプルさ**: 迷わず直感的に使える
- **視覚的満足感**: ステッカーを貼る達成感の再現
- **レスポンシブ**: スマートフォンでの利用を最優先
- **アクセシビリティ**: 色覚多様性への配慮

## 📊 データ管理

### LocalStorage構造
- ユーザー情報: `users`, `auth-state`
- ステッカー: `user-{userId}-sticker-calendar-YYYY-MM`
- ラベル: `user-{userId}-sticker-labels`

### ステッカー詳細
- 4色対応（赤・青・緑・黄）
- 各日付セル内で左上・右上・左下・右下に配置
- デフォルトラベル: 運動・勉強・読書・早起き

## 🎯 成功基準

### MVP完了基準
- ✅ カレンダーが正常に表示される
- ✅ ステッカーの貼り付け・取り消しが動作する
- ✅ データがブラウザに保存される
- ✅ スマートフォンで快適に操作できる
- ✅ 1週間継続して使用できる品質

### ユーザー体験基準
- ✅ 初回利用時に説明なしで使い方が理解できる
- ✅ ステッカーを貼る際の満足感がある
- ✅ 継続モチベーションが向上する

### 技術品質基準
- ✅ TypeScriptエラーがない
- ✅ レスポンシブデザインが適用されている
- ✅ アクセシビリティガイドラインを満たす（Lighthouse Score 96/100達成）
- ✅ パフォーマンスが良好（Lighthouse Score 90+達成）

## 🚧 開発状況

**現在のステータス**: 本番デプロイ完了、全機能実装済み、品質基準達成、コード整理完了
**最終更新**: 2025-10-13
**バージョン**: 5.1（コード品質改善版）
**本番環境**: https://putting-stickers-calendar.vercel.app/
**動作確認**: デスクトップ・スマートフォン・本番環境で完了

### コード品質改善完了（2025-10-13）
- ✅ **不要なコード削除**: デバッグ用console.log文の削除完了
- ✅ **エラーログ最適化**: 本番環境でのデバッグに必要なconsole.errorのみ保持
- ✅ **TypeScript型チェック**: `npx tsc --noEmit`で0エラー確認済み
- ✅ **本番ビルドテスト**: `npm run build`成功確認（致命的バグなし）
- ✅ **コードの可読性向上**: 不要なインポート削除、変数の最適化

### Lighthouse品質測定結果（2025-10-10）

本番環境で以下のスコアを達成：

| カテゴリー | スコア | 状態 |
|----------|--------|------|
| Performance | 90/100 | ✅ 目標達成 |
| Accessibility | 96/100 | ✅ 優秀 |
| Best Practices | 100/100 | ✅ 完璧 |
| SEO | 91/100 | ✅ 優秀 |

**主要メトリクス**:
- First Contentful Paint: 1.17秒
- Largest Contentful Paint: 2.12秒
- Cumulative Layout Shift: 0（完璧）

### アクセシビリティ改善完了（2025-10-11）
- ✅ ステッカーラベル（緑・黄）のコントラスト比改善
- ✅ 達成率表示のコントラスト比改善
- ✅ 前月・翌月日付に`aria-hidden`属性追加（装飾的要素として除外）
- Lighthouse Accessibility Score: 96/100達成

### TypeScript品質保証完了（2025-10-06）
- **型エラー完全解消**: `npx tsc --noEmit`で0エラー確認済み
- **RPC関数の最適化**: プロファイル作成をRPC関数経由に変更、曖昧性エラー解消
- **コード品質向上**: 型安全性の向上とエラーハンドリングの強化
- **ARIA属性追加**: アクセシビリティの強化（セマンティックHTML対応）

### RLSセキュリティ完了（2025-10-02）
- **Row Level Security**: 全テーブルでRLS有効化完了
- **セキュリティポリシー**: ユーザー別データ完全分離保証
- **自動プロファイル作成**: 新規ユーザー登録時の自動対応
- **マイグレーション**: セキュリティマイグレーション適用完了
- **不正アクセス防止**: データベースレベルでの厳格な権限制御

### 本番デプロイ完了（2025-09-28）
- **Vercelデプロイ**: 本番環境での安定動作確認済み
- **CI/CD**: GitHubリポジトリ連携による自動デプロイ設定完了
- **認証機能**: Supabase Auth本番環境で正常動作
- **データベース**: Supabase本番インスタンス利用
- **パフォーマンス**: Next.js本番ビルド最適化適用

### Supabase連携完了（2025-09-22）
- **ハイブリッド構成**: LocalStorage + Supabase連携完了
- **認証システム**: Supabase Auth完全統合
- **データ移行**: 既存LocalStorageデータのSupabase自動移行完了
- **オフライン対応**: ネットワークなしでも完全動作
- **クラウド同期**: リアルタイムデータ同期機能

### ステッカーアニメーション機能（2025-09-07）
- **ステッカーめくりアニメーション機能**を追加
  - 3D CSS Transformsを使った紙のめくれ効果
  - 貼り付け・剥がし時の滑らかなキーフレームアニメーション
  - ホバー時のインタラクティブな動作
  - リアルな影効果で立体感を表現

## 🚀 月別ラベル管理機能（実装予定）

### 機能概要
各月ごとに独立したステッカーラベルを設定・管理できる機能。過去の月を見たときは当時のラベル名で表示され、習慣の記録を正確に保持します。

### 主な仕様
- **過去のカレンダー表示**: その月に設定していたラベル名を表示
- **新しい月の初期値**: 前月のラベルを自動的に引き継ぐ
- **ラベル編集**: 過去の月も含めて編集可能（記録の修正に対応）

### 技術的な変更点
- `sticker_labels`テーブルに`year`と`month`カラムを追加
- 月別ラベル取得・保存機能の実装
- 既存データの自動移行（2025年10月のデータとして扱う）
- LocalStorageとSupabase両方での月別管理対応

### 実装予定時期
詳細はプロジェクトのマイルストーンをご確認ください。

## 📄 ライセンス

このプロジェクトは個人開発のため、ライセンスは未設定です。
